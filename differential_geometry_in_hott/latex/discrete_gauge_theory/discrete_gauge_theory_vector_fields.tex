\section{Vector fields}
\label{sec:vector_fields}
\subsection{Definition}
\label{sec:vector_field_def}
Vector fields are sections of the tangent bundle of a manifold. We do not have a general theory of tangent bundles, even for 2-dimensional cellular types, since we cannot yet prove that connections always exist on the 1-skeleton (see Section~\ref{sec:existence}). But if \( \mm\defeq\mm_0\to\mm_1\to\mm_2 \) is a cellular type, and \emph{given} an extension \( T:\mm\to\EMzo \) of the \( \link \) function, we can consider the type of sections \( \pit{x:\mm_1}T_1(x) \).

In this section and for the remainder of the note, we will assume that the bundle is principal, that is that the bundle is in fact a map \( T:\mm\to\Kzt \), the type of \( S^1 \)-torsors. This assumption is in principle not needed if \( M \) is equipped with an orientation \( \mathscr{O} \), but we are omitting a proof that such an \( \mathscr{O} \) provides a factorization of \( T \).

\begin{mydef}
Given a 2-dimensional cellular type \( \mm\defeq\mm_0\to\mm_1\to\mm_2 \) equipped with type family \( T:\mm\to\Kzt \) extending \( \link \), a \defemph{vector field} on \( \mm \) is a section on the 1-skeleton, i.e. a term \( X:\pit{x:\mm_1}T(x) \).
\end{mydef}

\begin{mynote}
The circle bundle extending \( \link \) captures the \emph{unit spheres} of the classical tangent bundle. A section of this bundle is therefore analogous to a classical \emph{nonvanishing} vector field. To allow for classical vector fields \emph{with zeros}, we are limiting the section \( X \) to the 1-skeleton of \( \mm \).
\end{mynote}

On the 0-skeleton \( X \) picks a point in each link, i.e. a neighbor of each vertex. On a path \( p:x=_\mm y \), \( X \) assigns a dependent path over \( p \), which as we know is a term \( \pi:\tr(p)(X(x))=_{T y} X(y) \). We are very interested in working with the concatenation operation on dependent paths, which we call \emph{swirling}.

\subsection{Swirling of dependent paths}
Consider the vertex \( v_1:\mm \), a face \( F \) containing vertices \( v_1, v_2, v_3 \), and the boundary path \( \ell\defeq e_{12}\cdot e_{23} \cdot e_{31} \). As we did in Section~\ref{sec:localtriv}, denote \( T(v_i) \) by \( T_i \) and \( T(e_{ij}) \) by \( T_{ji} \). The indices are swapped so that we can have expressions that respect function-composition order, such as \( T_{32}T_{21}(X_1):T_3 \). We retain the opposite convention (which we can call path-concatenation order) for the vector field, e.g. \( X_{ij} \) which is a path in \( T_j \), as these are paths. Figure~\ref{fig:vector_transport} shows in tabular form how we concatenate the dependent paths over \( e_{12}\cdot e_{23}\cdot e_{31} \). Figure~\ref{fig:swirling} shows visually a possible example.

\begin{figure}[h]
\centering
% https://q.uiver.app/#q=WzAsMTQsWzIsNCwiWF8zIl0sWzIsMywiVF97MzJ9WF8yIl0sWzIsMiwiVF97MzJ9VF97MjF9WF8xIl0sWzMsNCwiWF8xIl0sWzMsMywiVF97MTN9WF8zIl0sWzMsMiwiVF97MTN9VF97MzJ9WF8yIl0sWzMsMSwiVF97MTN9VF97MzJ9VF97MjF9WF8xIl0sWzAsMCwiVF8xIl0sWzEsMCwiVF8yIl0sWzIsMCwiVF8zIl0sWzMsMCwiVF8xIl0sWzAsNCwiWF8xIl0sWzEsNCwiWF8yIl0sWzEsMywiVF97MjF9WF8xIl0sWzcsOCwiVF97MjF9Il0sWzgsOSwiVF97MzJ9Il0sWzksMTAsIlRfezEzfSJdLFswLDEsIlhfezIzfToiLDAseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFszLDQsIlhfezMxfToiLDAseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsxLDIsIlRfezMyfVhfezEyfToiLDAseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs0LDUsIlRfezEzfVhfezIzfToiLDAseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs1LDYsIlRfezEzfVRfezMyfVhfezEyfToiLDAseyJsZXZlbCI6Miwic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsxMywxMiwiWF97MTJ9OiIsMix7ImxldmVsIjoyLCJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d
\begin{tikzcd}
  {T_1} & {T_2} & {T_3} & {T_1} \\
  &&& {T_{13}T_{32}T_{21}X_1} \\
  && {T_{32}T_{21}X_1} & {T_{13}T_{32}X_2} \\
  & {T_{21}X_1} & {T_{32}X_2} & {T_{13}X_3} \\
  {X_1} & {X_2} & {X_3} & {X_1}
  \arrow["{T_{21}}", from=1-1, to=1-2]
  \arrow["{T_{32}}", from=1-2, to=1-3]
  \arrow["{T_{13}}", from=1-3, to=1-4]
  \arrow["{T_{13}T_{32}X_{12}:}", equals, from=3-4, to=2-4]
  \arrow["{X_{12}:}"', equals, from=4-2, to=5-2]
  \arrow["{T_{32}X_{12}:}", equals, from=4-3, to=3-3]
  \arrow["{T_{13}X_{23}:}", equals, from=4-4, to=3-4]
  \arrow["{X_{23}:}", equals, from=5-3, to=4-3]
  \arrow["{X_{31}:}", equals, from=5-4, to=4-4]
\end{tikzcd}
\caption{The data in each fiber as we move around a triangle with vertices indexed 1, 2, and 3. Double lines indicate identity types between two types, and their labels are terms of this type (reading downwards, for example in the second column we have \( X_{12}:T_{21}X_1=X_2\)). Items with one index are terms of some type at a vertex, and items with two indices are terms of a type on an edge.}
\label{fig:vector_transport}
\end{figure}

As we traverse an edge, say \( e_{12} \), we get a path in \( T_2 \) which is the image of \( e_{12} \) under \( X \), denoted \( X_{12} \). As we traverse an additional edge, \( X_{12} \) is simply mapped to the next vertex by transport. The image is carried first to \( T_{32}(X_{12}) \) then to \( T_{13}\circ T_{32}(X_{12}) \).

\begin{figure}[h]
\centering
\input{figs/face_swirl_tikz.tex}
\caption{A vector field swirling clockwise around a face, in a bundle of squares. Imagine that transport along \( e_{12} \) does not rotate along the page, that transport along \( e_{23} \) rotates clockwise by 90 degrees, and that transport along \( e_{31} \) again does not rotate along the page. Thick black vectors are the vector field at a point. Thin vectors are transported once, dashed twice, and dotted three times. The vertices \( v_{ij} \) are in the tangent fibers. If you have a colorized version of the document, the colors of the arrows correspond: the red edge produced the red edge in the fibers.}
\label{fig:swirling}
\end{figure}

We wish to simplify expressions such as \( T_{13}T_{32}X_{12}\cdot T_{13}X_{23}\cdot X_{31} \), which take place in a particular fiber (\( T_1 \) in this case), and which depend on arranging for the endpoint of one segment to agree with the start of another. The simplification will empower us to easily perform calculations over the whole manifold, and to prove Theorem~\ref{thm:total_index_total_curvature}.

Recall that \( \so \) acts on all the fibers of \( T \). We will derive two operations involving \( \so \).

\begin{mydef}
The map \( \pr_1\circ (\alpha, \pr_2)^{-1}:T_i\times T_i\to \so \) is called \defemph{subtraction}. It maps \( (x,y) \) to the unique term \( \delta:\so \) such that \( \alpha(\delta, x)=y \). For brevity we denote \( \pr_1\circ (\alpha, \pr_2)^{-1}(x,y) \) by \( y-x \).
\end{mydef}

\begin{mylemma}
\label{lem:multpath}
If \( G \) is a higher group with multiplication \( \mu:G\times G\to G \) and proof of commutativity \( \mathsf{is\underscore comm}:\pit{a,b:G}\mu(a, b)=\mu(b, a) \) then \( \mu \) induces a function \( \mu_=:(x=_G y)\times (x'=_G y')\to (\mu(x, x')=_G\mu(y,y')) \).
\end{mylemma}
\begin{myproof}
If \( p:x=_G y \) and \( p':x'=_G y' \), then we can define \( \mu_=(p, p') \) by concatenating the three paths 
\begin{align*} 
\mu(x',p)&:\mu(x', x)=_G\mu(x', y)\\
\mathsf{is\underscore comm}(x',y)&:\mu(x',y)=_G\mu(y,x')\\
\mu(y, p')&:\mu(y, x')=_G\mu(y, y').\qedhere
\end{align*}
\end{myproof}

Each fiber \( T_i \) is pointed by \( X_i \), so we can define the map \( T_i\xrightarrow[]{-X_i}\so \), and then give a name to the special term \( T_{ij}X_j - X_i \).

\begin{mydef}
We define the \defemph{rotation} of \( T_{ij} \) by \( \rho_{ij}\defeq T_{ij}X_j - X_i \). The map \( +\rho_{ij}:\so\to\so \) makes the following diagram commute%
\end{mydef}%
\begin{equation}
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJUX2kiXSxbMSwwLCJUX2oiXSxbMCwxLCJcXG1hdGhzY3J7R30obSkiXSxbMSwxLCJcXG1hdGhzY3J7R30obSkiXSxbMCwxLCJUX3tqaX0iXSxbMSwzLCIoXFx0ZXh0ey19KS1YX2oiXSxbMCwyLCIoXFx0ZXh0ey19KS1YX2kiLDJdLFsyLDMsIihcXHRleHR7LX0pK1xccmhvX3tqaX0iLDJdXQ==
\begin{tikzcd}
  {T_i} & {T_j} \\
  {\so} & {\so}
  \arrow["{T_{ji}}", from=1-1, to=1-2]
  \arrow["{(\text{-})-X_i}"', from=1-1, to=2-1]
  \arrow["{(\text{-})-X_j}", from=1-2, to=2-2]
  \arrow["{(\text{-})+\rho_{ji}}"', from=2-1, to=2-2]
\end{tikzcd}
\label{eq:action_of_rho}
\end{equation}

\begin{mylemma} \( \rho_{ij}+\rho_{ji}=_{\so}0 \).
\label{lem:subtraction}\end{mylemma}
\begin{myproof}
\begin{align*}
(X_i + \rho_{ij})+\rho_{ji} &=_{T_i} T_{ij}X_j + \rho_{ji}&&\text{by definition of }\rho_{ij}\\
&=_{T_i} T_{ij}(X_j + \rho_{ji})&&\text{by equivariance of transport} \\
&=_{T_i} T_{ij}(T_{ji}(X_i))&&\text{by definition of }\rho_{ji}\\
&=_{T_i} X_i&&\text{by definition of }T\qedhere
\end{align*}
\end{myproof}
We can obtain a path in \( \so \) from a dependent path by again subtracting the basepoint:
\begin{align*}
\sigma_{ij}\defeq X_{ij}-X_j&:T_{ji}X_i-X_j=_{\so}0 \\
&:\rho_{ji}=_{\so}0.
\end{align*}
Notice the reversal in indices between \( \sigma_{ij} \) and \( \rho_{ji} \), which reflects our opposite conventions for \( X_{ij} \) which we view as a path, and \( T_{ji} \) which we view as a function.

The key technical lemma is the following. Recall that dependent functions such as our vector field \( X \) send \( \refl_{v_i} \) to \( \refl_{X_i} \) (by path induction, see for example \cite{hottbook} Lemma 2.3.4). As stated, this can only be used when we have a path that is \( \refl \), for example when traversing \( e_{ij}\cdot e_{ji} \), i.e. an edge followed by its inverse. We will use subtraction together with the operation of Lemma~\ref{lem:multpath} to lift this requirement, by obtaining paths in \( \so \) that can be added without needing to be concatenated directly.

\begin{mylemma}
\label{lem:cancellation}
With the notation \( \sigma_{ij}\defeq X_{ij}-X_j \), and with addition of paths as in Lemma~\ref{lem:multpath}, we have \( \sigma_{ij}+\sigma_{ji}=_{0=_{\so}0}\refl_0 \).
\end{mylemma}
\begin{myproof}
First we need to show that the sum is a loop, then we can prove that it is \( \refl_0 \). The terms have these types:
\begin{align*}
\sigma_{ij}&:\rho_{ji}=_{\so}0\\
\sigma_{ji}&:\rho_{ij}=_{\so}0
\end{align*}
so when we add these paths with \( + \) we obtain a path \( \sigma_{ij}+\sigma_{ji}:\rho_{ji}+\rho_{ij}=_{\so} 0 \) which by Lemma~\ref{lem:subtraction} is \( 0=_{\so}0 \). We compute \( + \) using the concatenations in Lemma~\ref{lem:multpath}, which gives
\begin{align*}
\sigma_{ij}+\sigma_{ji} &: 
  (0+0) \overeq{\mathrm{Lemma~}\ref{lem:subtraction}}
  (\rho_{ji}+\rho_{ij}) \overeq{\sigma_{ij}+\rho_{ij}}
  (0+\rho_{ij}) &&\overeq{\mathsf{is\underscore comm}}
  (\rho_{ij}+0) \overeq{\sigma_{ji}}
  (0+0)\\
\sigma_{ij}+\sigma_{ji}&=_{0=_{\so}0} (\sigma_{ij}+\rho_{ij})\cdot \sigma_{ji}&& \\
&=_{0=_{\so}0} ((X_{ij}-X_j)+\rho_{ij})\cdot (X_{ji} - X_i)&&\text{definition of }\sigma s\\
&=_{0=_{\so}0} (T_{ij}(X_{ij})-X_i)\cdot (X_{ji} - X_i)&&\text{action of }\rho_{ij}\text{ (see (\ref{eq:action_of_rho}))} \\
&=_{0=_{\so}0} \refl_{X_i}-X_i&&\text{path induction for }X\\
&=_{0=_{\so}0} \refl_0&&\qedhere
\end{align*}
\end{myproof}
\begin{mynote}
The classical argument of Hopf \cite{hopf}, which is presented in more detail in the more readily available \cite{needham}, makes an implicit assumption that we can concatenate two terms of different type such as \( X_{ij} \) and \( X_{kl} \). The authors name such terms ``change in angle across an edge'' and stipulate that this is a function ``defined on edges.'' The extra work we are doing in this section amounts to a partial formalization of this idea.
\end{mynote}

\subsection{An example vector field on the sphere}
\label{sec:octahedron_vector_field}
Figure~\ref{fig:octahedron_vector_field} shows an example of a vector field \( \xso \) (\( s \) for ``spin'') on the octahedron \( \oo \). The picture can really only convey the value of \( \xso \) on vertices, which it does by displaying it as an arrow on the surface itself, for example as an arrow from \( w \) to \( r \), instead of trying to draw the fiber at \( w \) which is where \( r:\link(w) \) actually lives. But hopefully there is a net gain in clarity.
\begin{figure}[h]
\centering
\input{figs/discrete_gauge_theory_oo_swirl}
\caption{A vector field on \( \oo \), which extends to a rotation of the octahedron in space.}
\label{fig:octahedron_vector_field}
\end{figure}

We will define \( \xso \) on edges, and then compute the swirling around each face. These calculations will then be cited later when we discuss the total swirling on a realization. Here is all the data for \( \xso \), which includes values when traversing an edge in either direction:
\[\begin{array}{|c|c|}
\hline
\multicolumn{2}{|c|}{\xso\text{ on vertices}} \\
\hline
v & \xso(v) \\
\hline
w & r \\
r & g \\
g & w \\
\hline
o & b \\
b & y \\
y & o \\
\hline
\end{array}\,
\begin{array}{|c|c|}
\hline
\multicolumn{2}{|c|}{\xso\text{ on north edges}} \\
\hline
e & \xso(e) \\
\hline
wr & yg \\
wg & rw \\
wo & wb \\
wb & ry \\
\hline
rw & gr \\
gw & br \\
ow & br \\
bw & br \\
\hline
\end{array}\,
\begin{array}{|c|c|}
\hline
\multicolumn{2}{|c|}{\xso\text{ on south edges}} \\
\hline
e & \xso(e) \\
\hline
yr & yg \\
yg & ow \\
yo & wb \\
yb & oy \\
\hline
ry & go \\
gy & go \\
oy & bo \\
by & go \\
\hline
\end{array}\,
\begin{array}{|c|c|}
\hline
\multicolumn{2}{|c|}{\xso\text{ on equator edges}} \\
\hline
e & \xso(e) \\
\hline
br & yg \\
rg & ow \\
go & wb \\
ob & ry \\
\hline
rb & ry \\
gr & wg \\
og & ow \\
bo & yb \\
\hline
\end{array}\]
How do we read the tables for the edges? For example, \( \xso(wr) \) should be a term of type \( \tr(wr)\xso(w)=_{Tr}\xso(r) \). Looking up \( \xso \) on vertices means this type is \( \tr(wr)(r)=_{Tr}g \), and looking up \( \tr \) in Definition~\ref{def:transport_oo} means the type is \( y=_{Tr}g \). We can choose \( \xso(wr) \) to be any path from \( y \) to \( g \) and we choose the short path \( yg \).

Next we want to compute \( \xso \) around a face. We will do this for the four north faces only. In this calculation we will denote paths by listing the vertices, so \( rg\cdot gw \) is denoted \( rgw \) and \( wrgw \) is a loop at \( w \).
\begin{align*}
\xso(wrgw) &= \tr(rgw)\xso(wr)\cdot\tr(gw)\xso(rg)\cdot\xso(gw)\\
&= \tr(rgw)(yg)\cdot\tr(gw)(ow)\cdot(br)\\
&= (yg\mapsto yo\mapsto \boxed{go})\cdot(ow\mapsto \boxed{ob})\cdot \boxed{br}\\
&= \boxed{gobr}
\end{align*}
To help follow along, in the third line we are showing the results of intermediate transports, and put a box around the result. The other three faces give
\begin{align*}
\xso(wgow) &= \tr(gow)\xso(wg)\cdot\tr(ow)\xso(go)\cdot\xso(ow)\\
&= \tr(gow)(rw)\cdot\tr(ow)(wb)\cdot(br)\\
&= (rw\mapsto gw\mapsto \boxed{gr})\cdot(wb\mapsto \boxed{rb})\cdot \boxed{br}\\
&= \boxed{gr}
\end{align*}

\begin{align*}
\xso(wobw) &= \tr(obw)\xso(wo)\cdot\tr(bw)\xso(ob)\cdot\xso(bw)\\
&= \tr(obw)(wb)\cdot\tr(bw)(ry)\cdot(br)\\
&= (wb\mapsto wr\mapsto \boxed{gr})\cdot(ry\mapsto \boxed{rb})\cdot \boxed{br}\\
&= \boxed{gr}
\end{align*}

\begin{align*}
\xso(wbrw) &= \tr(brw)\xso(wb)\cdot\tr(rw)\xso(br)\cdot\xso(rw)\\
&= \tr(brw)(ry)\cdot\tr(rw)(yg)\cdot(gr)\\
&= (ry\mapsto gy\mapsto \boxed{gr})\cdot(yg\mapsto \boxed{rg})\cdot \boxed{gr}\\
&= \boxed{gr}
\end{align*}

So we have these four edges in \( Tw \), which is pointed at \( \xso(w)=r \): \( gobr, gr, gr, gr \). Lemma~\ref{lem:multpath} tells us we can add these by transporting them so as to be concatenate-able. This gives \( gobr\cdot rb\cdot bo\cdot og=\refl_g \) in \( Tw \). So the total swirling in the northern hemisphere is trivial. We leave the computation in the southern hemisphere as an exercise, but it is very symmetrical with the northern hemisphere, and gives \( \refl_o \) in \( Ty \).
