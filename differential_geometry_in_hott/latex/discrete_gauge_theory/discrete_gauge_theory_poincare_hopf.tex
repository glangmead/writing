\section{Leibniz, Gauss-Bonnet, Poincar√©-Hopf}

\subsection{The Leibniz (product) rule}

The Leibniz rule for exterior differentiation states that if \( f, g:M\to \rr \) are two smooth functions to the real numbers then \( d(fg) = fdg + gdf \). Here \( fg \) is the function formed by taking the pointwise product of \( f \) and \( g \). This is an interaction between multiplication in \( \rr \) and the action on vectors of smooth functions (the 1-forms \( df \) and \( dg \)). 

To examine this situation in HoTT we need type-theoretic functions \( f, g:M\to B \) from some type \( M \) to a central H-space \( B \). Let \( \mu:B\to B\to B \) be the H-space multiplication. How does \( \mu \) act on paths? Suppose we have \( a, a', b, b':B \) and \( p:a=_B a', q:b=_B b' \). Then we also have homotopies \( \mu(p, -):\mu(a, -)=_{B\to B}\mu(a', -) \) and \( \mu(-,q):\mu(-,b)=_{B\to B}\mu(-,b'). \) Since \( \mu(a, -):B=B \) is an (unpointed) equivalence of \( B \), and similarly for \( \mu(b, -) \) and so on, this data assembles into the following diagram of higher groupoid morphisms:

\begin{center}
% https://q.uiver.app/#q=WzAsMyxbMiwwLCJCIl0sWzAsMCwiQiJdLFs0LDAsIkIiXSxbMSwwLCJcXG11KGEsLSkiLDAseyJjdXJ2ZSI6LTN9XSxbMSwwLCJcXG11KGEnLC0pIiwyLHsiY3VydmUiOjN9XSxbMCwyLCJcXG11KC0sYikiLDAseyJjdXJ2ZSI6LTN9XSxbMCwyLCJcXG11KC0sYicpIiwyLHsiY3VydmUiOjN9XSxbMyw0LCJcXG11KHAsLSkiLDIseyJzaG9ydGVuIjp7InNvdXJjZSI6MjAsInRhcmdldCI6MjB9fV0sWzUsNiwiXFxtdSgtLHEpIiwyLHsic2hvcnRlbiI6eyJzb3VyY2UiOjIwLCJ0YXJnZXQiOjIwfX1dXQ==
\begin{tikzcd}
  B && B && B
  \arrow[""{name=0, anchor=center, inner sep=0}, "{\mu(a,-)}", curve={height=-18pt}, from=1-1, to=1-3]
  \arrow[""{name=1, anchor=center, inner sep=0}, "{\mu(a',-)}"', curve={height=18pt}, from=1-1, to=1-3]
  \arrow[""{name=2, anchor=center, inner sep=0}, "{\mu(-,b)}", curve={height=-18pt}, from=1-3, to=1-5]
  \arrow[""{name=3, anchor=center, inner sep=0}, "{\mu(-,b')}"', curve={height=18pt}, from=1-3, to=1-5]
  \arrow["{\mu(p,-)}"', shorten <=5pt, shorten >=5pt, Rightarrow, from=0, to=1]
  \arrow["{\mu(-,q)}"', shorten <=5pt, shorten >=5pt, Rightarrow, from=2, to=3]
\end{tikzcd}
\end{center}

And so the two homotopies can be horizontally composed to give a path \[ \mu(p,-)\star\mu(-,q): \mu(a, b)=\mu(a',b'). \] Horizontal composition is given by \[\mu(p,-)\star\mu(-,q)\defeq(\mu(p,-)\cdot_r \mu(-,b))\cdot(\mu(a', -)\cdot_l\mu(-, q))\] where \[ \mu(p,-)\cdot_r\mu(-,b):\mu(a,b)=\mu(a',b) \] and \[ \mu(a',-)\cdot_l\mu(-,q):\mu(a',b)=\mu(a',b') \] are defined by path induction.  See the HoTT book Theorem 2.1.6 on the Eckmann-Hilton argument\cite{hottbook}.

We can recognize the process of using whiskering to form horizontal composition in the Leibniz rule. 

Quick aside: moving from infinitesimal calculus to finite groupoid algebra actually involves two changes. The first is the change from vectors to paths, forms to functions and so on. But it's also the case that tangent vectors have just the one basepoint, whereas paths have two endpoints. You can see this play out in this example, where \( a \) and \( a' \) were distinct points (and \( b \) and \( b' \)).

The horizontal composition we build lives entirely in \( B \) and we didn't make use of \( M \) yet. The Leibniz rule will be a pointwise version of what's going on in \( B \). Denote by \( \mu\circ(f,g):M\to B \) the map which sends \( x\mapsto \mu(f(x),g(x)) \).

\begin{mylemma}
Given \( f, g:M\to B \) and \( p:x=_M y \) then 
\begin{align*}
 \ap(\mu\circ(f,g))(p)&=\mu(f(p),-)\star\mu(-,g(p))\\
 &=\left[\mu(f(p),-)\cdot_r \mu(-,g(x))\right]\cdot \left[\mu(f(y),-)\cdot_l\mu(-,g(p))\right]\\
 &:\mu(f(x),g(x))=\mu(f(y),g(y))
\end{align*}
\end{mylemma}

\subsection{The total curvature}

On the 2-face \( F \) bounding a loop \( \ell:v=_M v \) the map \( T:M\to\EMzo \) assigns a homotopy \( T(F):\refl_v=T(\ell) \), where \( T(\ell) \) is an automorphism of \( T(v) \). The various 2-faces can be composed as terms of the 2-groupoid \( M \), and we will call the composition \( T(M):T(v)=T(v) \) the \emph{total curvature}.

When the fibers are torsors we need loops to see what \( T \) is doing.

\subsection{The total index}

If we have \( M\setminus Z \) for some isolated set of verticies \( Z \), then for each \( z:Z \) we can compose all the faces which contain \( z \), forming a new face. In this way we produce an equivalent type \( M_Z\simeq M \) but which is no longer combinatorial since we have erased some of the edges from some of the neighborhoods.

If \( X \) is a vector field with isolated zeroes on \( Z \), then \( M_Z \) is a convenient replacement for \( M \) because \( X \) is a partial function defined on all of \( M_Z \) except for a collection of faces, each of which bounds one of the zeroes of \( Z \).

If the combinatorial manifold was imported into type theory via some process of sampling or other, perhpaps more theoretical construction, then we should allow for zeroes to occur on verticies, edges, or faces. We can reduce the case of a zero on a vertex or edge to that of a face with the replacement method just described. The original combinatorial neighborhood structure continues to live in the fibers of \( T \), it's only the base manifold that has been replaced.

The action of \( X \) around loops in \( M_Z \) respects the inverting of paths, i.e. traversing them backwards. Therefore in order to perform calculations we must also know the direction of the paths. 

\begin{mydef}
Given a connected loop \( \ell:a=_{M_Z}a \) in \( M_Z \) that is running in the clockwise direction around a face of \( M_Z \) (i.e. the face is to the right of the path), we call the winding number of \( X(\ell) \) the \defemph{index} of \( X \) around \( \ell \). If we drop the clockwise requirement, then the winding number is also known as the \defemph{degree} of the map \( X \) on \( \ell \). In other words index can be thought of as ``clockwise degree.''
\end{mydef}


\subsection{Equality of total index and total curvature}

If we compute \( \tr_\ell X(a)=X(a) \) around every face boundary in \( M_Z \) then we can describe that in two ways. In homotopy type theory this is ``the 1-skeleton-over,'' the pathover for the concatenation of every loop. It is also the total difference between the curvature around every loop, and the vector field. It is also zero.

\begin{mythm}
The total pathover of all face boundaries is \( \refl_* \), hence the total curvature is equal to the total index of \( X \).
\end{mythm}
\begin{proof}
When we concatenate every loop we visit every edge twice in opposite directions.
\end{proof}

\begin{mycor}
The total index of a vector field with isolated zeroes is independent of the vector field.
\end{mycor}

\begin{mycor}
The total curvature is an integer.
\end{mycor}

The last step is to link this value to the Euler characteristic.

\subsection{Identification with Euler characteristic}

Combinatorial manifolds are intuitive objects that connect directly to the classical definition of Euler characteristic. We can argue using Morse theory, the study of smooth real-valued functions on smooth manifolds and their singularities. Classically the gradient of a Morse function is a vector field that can be used to decompose the manifold into its \emph{handlebody decomposition}. This would be an excellent story to pursue in future work.

Imagine a combinatorial manifold of a genus g oriented surface standing upright with the holes forming a vertical sequence. Now install a vector field that points downward whenever possible. This vector field will have a zero at the top and bottom, and one at the top and bottom of each hole. The top and bottom will be index 1, and ones around the holes will be index -1. 


